# Reusable workflow: Generate a contributor quality report for PRs
# Usage:
#   jobs:
#     report:
#       uses: dallay/common-actions/.github/workflows/contributor-report.yml@v1
#       secrets: inherit
name: Contributor Report

on:
  workflow_call:
    inputs:
      threshold-pr-merge-rate:
        description: "Minimum PR merge rate (0.0 to 1.0)"
        type: string
        required: false
        default: '0.3'
      threshold-account-age:
        description: "Minimum account age in days"
        type: string
        required: false
        default: '30'
      threshold-positive-reactions:
        description: "Minimum positive reactions count"
        type: string
        required: false
        default: '1'
      threshold-negative-reactions:
        description: "Maximum negative reactions count allowed"
        type: string
        required: false
        default: '5'
      trusted-users:
        description: "Comma-separated list of trusted user accounts (e.g., dependabot[bot],renovate[bot],github-copilot[bot])"
        type: string
        required: false
        default: 'dependabot[bot],renovate[bot],github-copilot[bot]'
      on-fail:
        description: "Action to take on failure (comment, fail, or both)"
        type: string
        required: false
        default: 'comment'

permissions:
  contents: read
  pull-requests: write

jobs:
  check-contributor:
    name: Contributor Quality Report
    runs-on: ubuntu-latest
    steps:
      - name: Check Contributor Report
        uses: jdiegosierra/contributor-report@4a818a3b891a36d84c2ad1860565df6884a2fd8e
        with:
          github-token: ${{ github.token }}
          threshold-pr-merge-rate: ${{ inputs.threshold-pr-merge-rate }}
          threshold-account-age: ${{ inputs.threshold-account-age }}
          threshold-positive-reactions: ${{ inputs.threshold-positive-reactions }}
          threshold-negative-reactions: ${{ inputs.threshold-negative-reactions }}
          trusted-users: ${{ inputs.trusted-users }}
          on-fail: ${{ inputs.on-fail }}
